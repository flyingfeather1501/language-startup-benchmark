#!/bin/bash
# language startup time benchmark
# thanks Rosetta Code for a convenient Hello World listing
#
# For compiled languages, I'm measuring the speed the compiled executable runs.
#
# I'm taking the "real" field in bash's "time" output
# (Specifically, TIMEFORMAT="%3R")

source compile.bash # compile:lang stuff
source report.bash # report_time etc.

# interpreted languages
report_time python python -c 'print("hello")'
report_time perl perl -e 'print("hello\n")'
report_time ruby ruby -e 'puts "hello"'
report_time lua lua -e 'print("hello")'
# shell
report_time bash bash -c 'echo "hello"'
report_time fish fish -c 'echo "hello"'
report_time zsh zsh -c 'echo "hello"'

# lisp family
report_time racket racket -e '(displayln "hello")'
report_time guile guile -c '(display "hello\n")'
report_time sbcl sbcl --noinform --non-interactive --eval '(format t "hello~%")'
report_time clisp clisp -q -x '(format t "hello~%")'
report_time "emacs lisp" emacs -batch -eval '(princ "hello\n")'

report_time clojure clojure -e '(println "hello")'

# since there's no 'run code on command line' functionality built in, use a file
# to avoid adding additional overhead with 'echo | io /dev/fd/0'
report_time io io hello.io

# js family
report_time node node --eval 'console.log("hello");'
report_time gjs gjs -c 'print("hello");'

report_time php php -n -r 'print("hello\n");' # -n: don't use configuration files

report_time "go (go run)" go run hello.go # this times the compilation as well

# compiled languages

# handle compile -> run -> cleanup in one place
compile_and_time () {
    # compile_and_time <lang> <func> <file>
    exe=$("$2" "$3")
    report_time "$1" "$exe"
    rm "$exe"
}

compile_and_time go compile:go hello.go
compile_and_time gcc compile:gcc hello.c
compile_and_time haskell compile:haskell hello.hs
compile_and_time vala compile:vala hello.vala
compile_and_time rust compile:rust hello.rs
compile_and_time nim compile:nim hello.nim

# I'm unable to generalize the execution for java, so this will have to do
exe_folder_java=$(compile:java hello.java)
report_time java java -cp "$exe_folder_java" hello
rm -rf "$exe_folder_java"
